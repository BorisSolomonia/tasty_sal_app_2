# Global options (keep simple while on bare IP)
{
    # email you@example.com   # (uncomment when you add a domain/TLS)
    auto_https off           # keep off on IP; enable when you use a domain
}

:80 {
  # Access log to stdout (you already saw this working)
  log {
    output stdout
    format console
  }

  # --- Optional: drop obviously-bad methods (scanner noise) ---
  @connect method CONNECT
  respond @connect 405

  # --- API first: route /api/* to backend on 3001 ---
  @api path /api/*
  handle @api {
    reverse_proxy nine-tones-app:3001 {
      health_checks {
        active {
          path /health
          interval 30s
          timeout 10s
          expect_status 200
        }
      }
    }
  }

  # --- Frontend SPA on 3000 ---
  reverse_proxy nine-tones-app:3000 {
    health_checks {
      active {
        path /
        interval 30s
        timeout 10s
        expect_status 200
      }
    }
  }
}
